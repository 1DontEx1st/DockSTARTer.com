



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="DockSTARTer helps you get started with home server apps running in Docker.">
      
      
        <link rel="canonical" href="https://dockstarter.com/Backups/">
      
      
        <meta name="author" content="GhostWriters">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.2.0">
    
    
      
        <title>Backups - DockSTARTer</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.750b69bd.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="#546e7a">
      
    
    
      <script src="../assets/javascripts/modernizr.74668098.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue-grey" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#creating-backups" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://dockstarter.com/" title="DockSTARTer" class="md-header-nav__button md-logo">
          
            <img src="../img/icon.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              DockSTARTer
            </span>
            <span class="md-header-nav__topic">
              Backups
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/GhostWriters/DockSTARTer/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GhostWriters/DockSTARTer
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="https://dockstarter.com/" title="DockSTARTer" class="md-nav__button md-logo">
      
        <img src="../img/icon.png" width="48" height="48">
      
    </a>
    DockSTARTer
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/GhostWriters/DockSTARTer/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    GhostWriters/DockSTARTer
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Basics
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Basics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Advanced-Usage/" title="Advanced Usage" class="md-nav__link">
      Advanced Usage
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Migration/" title="How to Migrate to DS" class="md-nav__link">
      How to Migrate to DS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Frequently-Asked-Questions/" title="Frequently Asked Questions" class="md-nav__link">
      Frequently Asked Questions
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Application Specifics
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Application Specifics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../AirDCpp/" title="AirDCpp" class="md-nav__link">
      AirDCpp
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ddclient/" title="ddclient" class="md-nav__link">
      ddclient
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../DelugeVPN/" title="DelugeVPN" class="md-nav__link">
      DelugeVPN
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Duplicati/" title="Duplicati" class="md-nav__link">
      Duplicati
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Home-Assistant/" title="Home Assistant" class="md-nav__link">
      Home Assistant
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Let's-Encrypt-(Certbot)/" title="Let's Encrypt (Certbot)" class="md-nav__link">
      Let's Encrypt (Certbot)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Logarr/" title="Logarr" class="md-nav__link">
      Logarr
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Netdata/" title="Netdata" class="md-nav__link">
      Netdata
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../NextCloud/" title="NextCloud" class="md-nav__link">
      NextCloud
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Ouroboros/" title="Ouroboros" class="md-nav__link">
      Ouroboros
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Pi‐hole/" title="Pi‐hole" class="md-nav__link">
      Pi‐hole
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Plex/" title="Plex" class="md-nav__link">
      Plex
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Portainer/" title="Portainer" class="md-nav__link">
      Portainer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Samba/" title="Samba" class="md-nav__link">
      Samba
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Watchtower/" title="Watchtower" class="md-nav__link">
      Watchtower
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Various Topics
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Various Topics
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../SMB-Mounting/" title="SMB Mounting" class="md-nav__link">
      SMB Mounting
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../VPN-Information/" title="VPN Information" class="md-nav__link">
      VPN Information
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      Videos/Walkthroughs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Videos/Walkthroughs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="https://www.youtube.com/watch?v=6pkbS07CAnU" title="Video - Getting Started" class="md-nav__link">
      Video - Getting Started
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      Other Pages
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Other Pages
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../Advanced-Usage/" title="Advanced Usage" class="md-nav__link">
      Advanced Usage
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Available-Applications/" title="Available Applications" class="md-nav__link">
      Available Applications
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
    <a href="./" title="Backups" class="md-nav__link md-nav__link--active">
      Backups
    </a>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Overrides/" title="Overrides" class="md-nav__link">
      Overrides
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Setting-Up-a-Domain/" title="Setting Up a Domain" class="md-nav__link">
      Setting Up a Domain
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Technical-Info/" title="Technical Info" class="md-nav__link">
      Technical Info
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/GhostWriters/DockSTARTer/edit/docs/docs/Backups.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="creating-backups">Creating backups</h1>
<p>DockSTARTer menu has an option for <code>Backup Config</code>, or you can use one of <code>sudo ds -b min</code> / <code>sudo ds -b med</code> / <code>sudo ds -b max</code> to create backups.</p>
<pre><code>Min: Backs up your .env file
Med: Backs up your .env file and the config folder for any enabled app
Max: Backs up your .env file and any config folder found in your DOCKERCONFDIR. Apps will be stopped before running a backup and started after completing a backup.
</code></pre>

<p>Med and Max also support pre/post commands in between each app (so you could disable uptime monitors for example)
Min, Med, and Max support pre/post commands for the entire run. These commands can be set in <code>.env</code></p>
<p>Quote from our Discord server:</p>
<blockquote>
<p>Min only backs up .env (no need to stop anything)</p>
<p>Med backs up enabled app configs without stopping containers. The biggest concern would be database files. The rest generally won't be locked.</p>
<p>Max backs up each folder in your config folder even if there's no enabled app for that folder, and it stops each app before performing the backup and starts the app after the backup completes. Each app is only stopped during it's own backup and started before the next apps backup begins, and only started if it was running before the backup process started.
So basically:</p>
</blockquote>
<pre><code>Stop radarr
Backup radarr
Start radarr
Stop sonarr
Backup sonarr
Start sonarr
</code></pre>

<blockquote>
<p>And if you had a config for an app you disabled it'll still backup that config but won't start the app after the backup (because the app wasn't running)</p>
</blockquote>
<h1 id="scheduling-backups">Scheduling backups</h1>
<p>It is recommended to setup a cron job using <code>sudo crontab -e</code> and adding a line like</p>
<pre><code>0 2 * * * /home/&lt;USER&gt;/.docker/main.sh -b min
</code></pre>

<p>or</p>
<pre><code>0 2 * * * /home/&lt;USER&gt;/.docker/main.sh -b med
</code></pre>

<p>or</p>
<pre><code>0 2 * * * /home/&lt;USER&gt;/.docker/main.sh -b max
</code></pre>

<p>Which would make a daily backup at 2 AM.</p>
<h1 id="backup-retention">Backup retention</h1>
<p>The snapshot backup is created into <code>${BACKUP_CONFDIR}/&lt;appname&gt;.001</code>. If the folder <code>&lt;appname&gt;.001</code> exists already it is rotated to <code>&lt;appname&gt;.002</code> and so on, up to <code>&lt;appname&gt;.512</code> by default (this can be adjusted), thereafter it is removed. So if you create one backup per night, for example with a cronjob, then this retention policy gives you 512 days of retention. This is useful but this can require to much disk space, that is why we have included a non-linear distribution policy. In short, we keep only the oldest backup in the range 257-512, and also in the range 129-256, and so on. This exponential distribution in time of the backups retains more backups in the short term and less in the long term; it keeps only 10 or 11 backups but spans a retention of 257-512 days.
In the following table you can see on each column the different steps of the rotation, where each column shows the current set of snapshots (limited from <appname>.1 to <appname>.16 in this example):</p>
<pre><code>1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1   1
2   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2   2
    3       3       3       3       3       3       3       3
4       4       4       4       4       4       4       4       4
    5               5               5               5
        6               6               6               6
            7               7               7               7
8               8               8               8               8
    9                               9
        10                              10
            11                              11
                12                              12
                    13                              13
                        14                              14
                            15                              15
16                              16                              16
</code></pre>

<p>To save more disk space, <code>rsync</code> will make hard links for each file of <code>&lt;appname&gt;.001</code> that already existed in <code>&lt;appname&gt;.002</code> with identical content, timestamps and ownerships.</p>
<h1 id="deleting-backups">Deleting backups</h1>
<p>Backups created by DockSTARTer will be protected with a special attribute called <code>immutable</code> that makes the backups read only to all users including root. This is done to protect your backups from accidental deletion. Backups will be rotated through retention as described above because the backup script handles the immutable attribute. If you need to delete a backup manually you will first need to remove the immutable attribute from the folder using <code>sudo chattr -R -i /path/to/backup/&lt;appname&gt;.###</code></p>
<h1 id="credits">Credits</h1>
<p>The backup function is strongly borrowed from <a href="http://www.pointsoftware.ch/en/howto-local-and-remote-snapshot-backup-using-rsync-with-hard-links/">http://www.pointsoftware.ch/en/howto-local-and-remote-snapshot-backup-using-rsync-with-hard-links/</a> which has sections explaining how the <code>rsync</code> process works, including information about hard links (backups don't take up as much space as you think!)</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../Available-Applications/" title="Available Applications" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Available Applications
              </span>
            </div>
          </a>
        
        
          <a href="../Overrides/" title="Overrides" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Overrides
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 - 2019 GhostWriters
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.39abc4af.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>